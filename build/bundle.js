let sendSession=async(e,s=!1,o="")=>{o={method:"POST",keepalive:!0,headers:{Authorization:"Bearer "+tenantToken,"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({externalId:orderFormId,externalTestId:o,isShowcaseSeen:s})};try{if(!(await fetch(baseUrl+"v1/sessions",o)).ok)throw new Error("Network response was not ok")}catch(e){console.error("Fetch error:",e)}},sessionHandler=async e=>{var s=window?.localStorage?.getItem("orderform"),s=JSON.parse(s)?.id,o=sessionStorage.getItem(e);o&&o===sessionId||(sessionStorage.setItem(e,s),"normalSession"===e?sendSession(s):"shelfSession"===e&&sendSession(s,!0))};

let mainProductPageView=()=>{var e,r=async(e,r="")=>{var t=window?.localStorage?.getItem("orderform"),t=JSON.parse(t)?.id,r={method:"POST",keepalive:!0,headers:{Authorization:"Bearer "+tenantToken,"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({origin:r,externalSessionId:t,externalSkuId:"string",externalFromSkuId:"string"})};try{if(console.log("aqui sera o post pageview"),!(await fetch(baseUrl+"v1/page-views",r)).ok)throw new Error("Network response was not ok")}catch(e){console.error("Fetch error:",e)}},t=(e=localStorage.getItem("currentShelfInteractions"))?JSON.parse(e):[];if(!t)return r(0,""),null;var o=document.referrer.replace(window?.location?.origin,"");let a=!0;for(let e=0;e<t.length;e++){var n=t[e];n?.originUrl===o&&n?.targetUrl===window?.location?.pathname?(t.pop(n),r(0,n?.origin||"shelf"),a=!1):(n.readCount=n.readCount+1,5<n?.readCount&&t.pop(n))}a&&r(0,""),localStorage.setItem("currentShelfInteractions",JSON.stringify(t))};
let sendInteractionsToOrderVtex=e=>{(async e=>{var t=(a=await(await fetch("/api/checkout/pub/orderForm",{method:"GET",headers:{"content-type":"application/json"},keepalive:!0})).json())?.orderFormId,a=(a?.customData?.customApps?.find(e=>"wec_ino"==e?.id))?.fields?.shelfItemInteraction;let o;return o=a?[...JSON.parse(a),e]:[e],a={method:"PUT",body:JSON.stringify({value:JSON.stringify(o)}),headers:{"Content-Type":"application/json"},keepalive:!0},await(await fetch(`/api/checkout/pub/orderForm/${t}/customData/wec_ino/shelfItemInteraction`,a)).json()})(e)};
let scriptTagEl=document.currentScript,version=scriptTagEl.getAttribute("data-version"),baseUrl="https://performance.api.cuboapp.net/",tenantToken=scriptTagEl.getAttribute("data-token0");function main(){console.log("main",baseUrl,tenantToken);let e=()=>{sessionHandler("normalSession")},t=()=>{console.log("render normalPdpRender"),e(),mainProductPageView();let t=0,a=setInterval(async()=>{var e=document.getElementById("corel_container");10<++t?clearInterval(a):e&&((async()=>{var e=await fetchProducts();"fulfilled"===e[0].status&&(document.querySelector(".shelfWrapper")&&document.querySelectorAll(".shelfWrapper").forEach(e=>{e.remove()}),await renderShelf(e[0]?.value),initializeSlider()),observerHandler()})(),clearInterval(a))},1e3)},a;window.addEventListener("message",function(e){e.data&&e.data.eventName&&(console.log("VTEX Event Received:",e.data),"vtex:productView"===e.data.eventName)&&parseInt(e.data.product.productId)!==a&&(a=e.data.product.productId,t())}),document.addEventListener("DOMContentLoaded",()=>{e()})}function abVersionHandler(){"a"==version&&(console.log("Master workspace"),baseUrl="https://api.cuboapp.net/",tenantToken=scriptTagEl.getAttribute("data-token0")),"b"==version&&(console.log("other workspace"),baseUrl="https://performance.api.inovacao.wecode.digital/",tenantToken=scriptTagEl.getAttribute("data-token1"),main()),console.log("version",version)}abVersionHandler();
let getDataSetFromElement=e=>{var t=document.querySelector(e);return t?t.dataset:(console.error(`Element with id ${e} not found`),null)},fetchProducts=async()=>{var{skuid:e,itemsfetched:t}=getDataSetFromElement("#corel_container"),n={method:"GET",headers:{Authorization:"Bearer "+tenantToken,"Content-Type":"application/json; charset=utf-8"}};try{var r,a=await fetch(baseUrl+`v1/skus/${e}?batchSize=`+t,n);if(a.ok)return r=await a.json(),await Promise.allSettled([r]);throw new Error("Network response was not ok")}catch(e){console.error("Fetch error:",e)}},observerHandler=()=>{var e=document.querySelectorAll(".shelfItem");e&&e.forEach((e,t)=>{var n;return e?((n=productViewHandler(e.getAttribute("sku_id"),e.getAttribute("recommendationAlgorithm"))).observe(e),n):null})},productViewHandler=(n,r)=>{let a=!1;return new IntersectionObserver((e,t)=>{1!=e.find(e=>e.isIntersecting)?.isIntersecting||a||((async()=>{sendInteraction(n,1,r),sessionHandler("shelfSession")})(),a=!0,t.disconnect())},{threshold:[0]})},productClickHandler=(e,t,n,r,a)=>{saveClick(n,r),sendClick(t,r),obj={pageSkuId:e,skuId:t,origin:r,position:a},sendInteractionsToOrderVtex(obj)},sendInteraction=async(e,t,n)=>{var r=window?.localStorage?.getItem("orderform"),r=JSON.parse(r)?.id,r={method:"POST",keepalive:!0,headers:{Authorization:"Bearer "+tenantToken,"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({externalSessionId:r,externalId:e,eventType:t,recommendationAlgorithm:n})};try{if(!(await fetch(baseUrl+"v1/sku-events",r)).ok)throw new Error("Network response was not ok")}catch(e){console.error("Fetch error:",e)}},sendClick=async(e,t)=>{sendInteraction(e,0,t)},saveClick=(e,t)=>{e={originUrl:window?.location?.pathname,targetUrl:e,origin:t,readCount:0};let n;var t=localStorage.getItem("currentShelfInteractions");n=t?((t=JSON.parse(t)).push(e),t):[e],localStorage.setItem("currentShelfInteractions",JSON.stringify(n))};function verifyImage(n){return new Promise(e=>{var t=new Image;t.onload=()=>e(!0),t.onerror=()=>e(!1),t.src=n})}let renderShelf=async e=>{let{skuid:r,imgsize:a}=getDataSetFromElement("#corel_container");var t=document.getElementById("corel_container"),n=document.createElement("div"),o=(n.className="shelfWrapper",document.createElement("h4")),l=(o.className="shelfTitle",o.textContent="Recomendados para vocÃª",document.createElement("div")),i=(l.className="sliderContainer",document.createElement("button")),c=(i.className="prevButton",i.innerHTML="&#10094;",document.createElement("button"));c.className="nextButton",c.innerHTML="&#10095;",n.appendChild(i),n.appendChild(c);let s=0;for(let n of e){console.log("el",n);let t=s;var d=document.createElement("div"),m=(d.className="shelfItem",d.setAttribute("sku_id",n?.externalId),d.setAttribute("sku_id",n?.externalId),d.setAttribute("recommendationAlgorithm",n?.recommendationAlgorithm),d.addEventListener("click",()=>{productClickHandler(r,n?.externalId,n?.uri,n?.recommendationAlgorithm,t+1)}),d.addEventListener("auxclick",e=>{(1===e.button||0===e.button&&(e.ctrlKey||e.metaKey))&&productClickHandler(r,n?.externalId,n?.uri,n?.recommendationAlgorithm,t+1)}),d.addEventListener("contextmenu",e=>{productClickHandler(r,n?.externalId,n?.uri,n?.recommendationAlgorithm,t+1)}),document.createElement("a")),u=(m.className="shelfItemLink",m.href=n?.uri,document.createElement("img")),h=(u.className="shelfItemImage",u.src=n?.imageUrl?.replace(/\/ids\/(\d+)(-\d+-\d+)?/,(e,t,n)=>`/ids/${t}-`+a),u.alt=n?.name,document.createElement("p"));h.className="shelfItemName",h.textContent=n?.name,d.appendChild(u),d.appendChild(h),d.appendChild(m),await verifyImage(u.src)?(console.log("true"),l.appendChild(d)):console.log("false"),s++}n.appendChild(o),n.appendChild(l),t.appendChild(n)};initializeSlider=()=>{let a=parseInt(getDataSetFromElement("#corel_container")?.margin,10),o=parseInt(getDataSetFromElement("#corel_container")?.itemsperpage,10),l=document.querySelector(".sliderContainer"),i=l.querySelectorAll(".shelfItem"),c=i.length,s=0,t=[],n=(e,n)=>{var t=Math.floor(e.parentElement.clientWidth),t=Math.floor(t/o)*o;let r=Math.floor(t/o)-a;0<n.length&&n.forEach(e=>clearTimeout(e)),i.forEach((e,t)=>{e.style.width=r+"px",e.style.marginRight=a+"px",t>=o*(s+1)?n.push(setTimeout(()=>{e.style.display="none"},500)):e.style.display="block"});t=(r+a)*c;e.style.width=t+"px"},d=()=>{var e=i[0].offsetWidth+a,e=-s*e*o;l.style.transform=`translateX(${e}px)`,r(),n(l,t)};let r=()=>{document.querySelectorAll(".dot").forEach((e,t)=>{e.className=t===s?"dot active":"dot"})},e=e=>{var t=Math.ceil(c/o);s=(s+e+t)%t,d()},m=(document.querySelector(".prevButton").addEventListener("click",()=>e(-1)),document.querySelector(".nextButton").addEventListener("click",()=>e(1)),0),u=0;l.addEventListener("touchstart",e=>{m=e.touches[0].clientX}),l.addEventListener("touchmove",e=>{u=e.touches[0].clientX}),l.addEventListener("touchend",()=>{50<m-u?e(1):50<u-m&&e(-1)}),new ResizeObserver(()=>{n(l,t),d()}).observe(l.parentElement),n(l,t),(()=>{var t=document.createElement("div"),n=(t.className="dotsContainer",Math.ceil(c/o));for(let e=0;e<n;e++){var r=document.createElement("span");r.className="dot",r.addEventListener("click",()=>{s=e,d()}),t.appendChild(r)}l.parentElement.appendChild(t)})(),d()};